/**
 * This ruleset enforces a security model for a portfolio or CMS application.
 *
 * Core Philosophy:
 * The security model is centered around an 'authenticated user' role. Logged-in users have full
 * control over all content collections. Most content is publicly readable by any user, signed-in
 * or not. This is ideal for a public-facing website where content is managed through a secure
 * admin panel by the site owner.
 *
 * Data Structure:
 * The data is organized into top-level collections representing different sections of the website
 * (e.g., /content, /projects, /certificates).
 *
 * Key Security Decisions:
 * - Public Content: All collections representing website content are publicly readable (`get`, `list`)
 *   to ensure the website can be viewed by anyone.
 * - Authenticated-Only Writes: All write operations (`create`, `update`, `delete`) on content collections are
 *   strictly limited to any authenticated user. This is a simpler security model suitable for a single-admin site.
 * - Contact Form: The `/contactFormSubmissions` collection has unique rules. It is publicly writable
 *   (`create`) so anyone can submit the form, but it is readable and deletable only by authenticated users.
 *   Submissions are immutable (updates are forbidden).
 *
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --------------------------------------------------------------------------------
    // Helper Functions
    // --------------------------------------------------------------------------------

    /**
     * Checks if the user is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    // --------------------------------------------------------------------------------
    // Content Collections (Managed by any authenticated user)
    // --------------------------------------------------------------------------------

    /**
     * @description Generic rule for content documents. Publicly readable, authenticated-user-only writes.
     * @path /content/{document}
     * @allow Any user can read.
     * @deny A non-logged-in user tries to update.
     */
    match /content/{document} {
      allow get, list: if true;
      allow write: if isSignedIn();
    }

    /**
     * @description Defines rules for projects. Publicly readable, authenticated-user-only writes.
     * @path /projects/{projectId}
     */
    match /projects/{projectId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Defines rules for certificates. Publicly readable, authenticated-user-only writes.
     * @path /certificates/{certificateId}
     */
    match /certificates/{certificateId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Defines rules for skills. Publicly readable, authenticated-user-only writes.
     * @path /skills/{skillId}
     */
    match /skills/{skillId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }
    
    /**
     * @description Defines rules for social media links. Publicly readable, authenticated-user-only writes.
     * @path /socialLinks/{socialLinkId}
     */
    match /socialLinks/{socialLinkId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    // --------------------------------------------------------------------------------
    // Special Collections
    // --------------------------------------------------------------------------------

    /**
     * @description Contact form submissions can be created by anyone, but only read and deleted by authenticated users. Updates are disallowed.
     * @path /contactFormSubmissions/{contactFormSubmissionId}
     */
    match /contactFormSubmissions/{contactFormSubmissionId} {
      allow get, list: if isSignedIn();
      allow create: if true;
      allow update: if false;
      allow delete: if isSignedIn();
    }
  }
}
